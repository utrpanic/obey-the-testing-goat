<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Javascript tests</title>
    <link rel="stylesheet" href="../../../superlists/static/tests/qunit.css">
</head>

<body>
    <div id="qunit"></div>
    <div id="qunit-fixture">
        <a id="id_login">로그인</a>
    </div>

    <script src="http://code.jquery.com/jquery.min.js"></script>
    <script src="../../../superlists/static/tests/qunit.js"></script>
    <script src="../../../superlists/static/tests/sinon.js"></script>
    <script src="../accounts.js"></script>
    <script>
/*global $, test, equal, sinon, Superlists */
QUnit.test("initialize가 로그인 버튼에 navigator.id.request를 바인딩", function(assert) {
    var requestWasCalled = false;
    var mockRequestFunction = function () { requestWasCalled = true; };
    var mockNavigator = {
        id: {
            request: mockRequestFunction,
            watch: function () {}
        }
    };
    Superlists.Accounts.initialize(mockNavigator);
    assert.equal(requestWasCalled, false, '클릭 전에 request가 호출되지 않는지 확인');
    $('#id_login').trigger('click');
    assert.equal(requestWasCalled, true, '클릭 후에 request가 호출되는 것을 확인');
});
QUnit.test("initialize가 navigator.id.watch를 호출", function(assert) {
    var user = '현재 사용자';
    var token = 'csrf token';
    var urls = { login: 'login url', logout: 'logout url' };
    var mockNavigator = {
        id: {
            watch: sinon.mock()
        }
    };
    Superlists.Accounts.initialize(mockNavigator, user, token, urls);
    assert.equal(
        mockNavigator.id.watch.calledOnce,
        true,
        'watch 함수가 호출되는지 확인'
    );
});
QUnit.test("watch가 현재 사용자를 확인", function (assert) {
    var user = '현재 사용자';
    var token = 'csrf token';
    var urls = { login: 'login url', logout: 'logout url' };
    var mockNavigator = {
        id: {
            watch: sinon.mock()
        }
    };
    Superlists.Accounts.initialize(mockNavigator, user, token, urls);
    var watchCallArgs = mockNavigator.id.watch.firstCall.args[0];
    assert.equal(watchCallArgs.loggedInUser, user, '사용자 확인');
});
    </script>
</body>
</html>
